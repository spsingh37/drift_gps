\hypertarget{imu__propagation_8h_source}{}\doxysection{imu\+\_\+propagation.\+h}
\label{imu__propagation_8h_source}\index{/home/neofelis/VRX/drift/include/drift/filter/inekf/propagation/imu\_propagation.h@{/home/neofelis/VRX/drift/include/drift/filter/inekf/propagation/imu\_propagation.h}}
\mbox{\hyperlink{imu__propagation_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/* -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{2 \textcolor{comment}{ * Copyright 2023, CURLY Lab, University of Michigan}}
\DoxyCodeLine{3 \textcolor{comment}{ * All Rights Reserved}}
\DoxyCodeLine{4 \textcolor{comment}{ * See LICENSE for the license information}}
\DoxyCodeLine{5 \textcolor{comment}{ * -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ */}}
\DoxyCodeLine{6 }
\DoxyCodeLine{20 \textcolor{preprocessor}{\#ifndef FILTER\_INEKF\_PROPAGATION\_IMU\_PROPAGATION\_H}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#define FILTER\_INEKF\_PROPAGATION\_IMU\_PROPAGATION\_H}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{base__propagation_8h}{drift/filter/base\_propagation.h}}"{}}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{inekf_8h}{drift/filter/inekf/inekf.h}}"{}}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{lie__group_8h}{drift/math/lie\_group.h}}"{}}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{imu_8h}{drift/measurement/imu.h}}"{}}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{type__def_8h}{drift/utils/type\_def.h}}"{}}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespacemath}{math}};}
\DoxyCodeLine{32 \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespacestate}{state}};}
\DoxyCodeLine{33 \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespacemeasurement}{measurement}};}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacefilter_1_1inekf}{filter::inekf}} \{}
\DoxyCodeLine{45 \textcolor{keyword}{class }\mbox{\hyperlink{classfilter_1_1inekf_1_1ImuPropagation}{ImuPropagation}} : \textcolor{keyword}{public} \mbox{\hyperlink{classfilter_1_1Propagation}{Propagation}} \{}
\DoxyCodeLine{46  \textcolor{keyword}{public}:}
\DoxyCodeLine{47   EIGEN\_MAKE\_ALIGNED\_OPERATOR\_NEW}
\DoxyCodeLine{48 }
\DoxyCodeLine{51   \textcolor{comment}{// ======================================================================}}
\DoxyCodeLine{62 \textcolor{comment}{}  \mbox{\hyperlink{classfilter_1_1inekf_1_1ImuPropagation}{ImuPropagation}}(\mbox{\hyperlink{type__def_8h_ac57b15fb1e344a7041a287e5d13e1b00}{IMUQueuePtr}} sensor\_data\_buffer\_ptr,}
\DoxyCodeLine{63                  std::shared\_ptr<std::mutex> sensor\_data\_buffer\_mutex\_ptr,}
\DoxyCodeLine{64                  \textcolor{keyword}{const} \mbox{\hyperlink{namespacefilter_1_1inekf_a7ef14ea922d7f9fc9e348cb4a18e1823}{ErrorType}}\& error\_type, \textcolor{keyword}{const} std::string\& yaml\_filepath);}
\DoxyCodeLine{66 }
\DoxyCodeLine{69   \textcolor{comment}{// ======================================================================}}
\DoxyCodeLine{81 \textcolor{comment}{}  \textcolor{keywordtype}{bool} \mbox{\hyperlink{classfilter_1_1inekf_1_1ImuPropagation_acb0e0bf386489dbda5c93537dda110f2}{Propagate}}(\mbox{\hyperlink{classstate_1_1RobotState}{RobotState}}\& \mbox{\hyperlink{namespacestate}{state}}) \textcolor{keyword}{override};}
\DoxyCodeLine{83 }
\DoxyCodeLine{86   \textcolor{comment}{// ======================================================================}}
\DoxyCodeLine{92 \textcolor{comment}{}  \textcolor{keyword}{const} Eigen::Vector3d \mbox{\hyperlink{classfilter_1_1inekf_1_1ImuPropagation_af7611c07f289cfd33a95918a85a59e46}{get\_estimate\_gyro\_bias}}() \textcolor{keyword}{const};}
\DoxyCodeLine{93 }
\DoxyCodeLine{94   \textcolor{comment}{// ======================================================================}}
\DoxyCodeLine{100 \textcolor{comment}{}  \textcolor{keyword}{const} Eigen::Vector3d \mbox{\hyperlink{classfilter_1_1inekf_1_1ImuPropagation_abf389d980f3374fe0c5e505bf1bb199f}{get\_estimate\_accel\_bias}}() \textcolor{keyword}{const};}
\DoxyCodeLine{101 }
\DoxyCodeLine{102   \textcolor{comment}{// ======================================================================}}
\DoxyCodeLine{110 \textcolor{comment}{}  \textcolor{keyword}{const} \textcolor{keywordtype}{bool} \mbox{\hyperlink{classfilter_1_1inekf_1_1ImuPropagation_afbfc6a1454d76de70cb15cfbf3dfa445}{get\_bias\_initialized}}() \textcolor{keyword}{const};}
\DoxyCodeLine{111 }
\DoxyCodeLine{112   \textcolor{comment}{// ======================================================================}}
\DoxyCodeLine{120 \textcolor{comment}{}  \textcolor{keyword}{const} \mbox{\hyperlink{type__def_8h_ac57b15fb1e344a7041a287e5d13e1b00}{IMUQueuePtr}} \mbox{\hyperlink{classfilter_1_1inekf_1_1ImuPropagation_a0eeb549b42c48974f3121e12aa7dd281}{get\_sensor\_data\_buffer\_ptr}}() \textcolor{keyword}{const};}
\DoxyCodeLine{122 }
\DoxyCodeLine{124   \textcolor{comment}{//\{}}
\DoxyCodeLine{125   \textcolor{comment}{// ======================================================================}}
\DoxyCodeLine{134 \textcolor{comment}{}  \textcolor{keywordtype}{void} \mbox{\hyperlink{classfilter_1_1inekf_1_1ImuPropagation_ada424877921c3c31f32dea9f704affda}{InitImuBias}}();}
\DoxyCodeLine{136 }
\DoxyCodeLine{139   \textcolor{comment}{// ======================================================================}}
\DoxyCodeLine{147 \textcolor{comment}{}  \textcolor{keywordtype}{bool} \mbox{\hyperlink{classfilter_1_1inekf_1_1ImuPropagation_a6a575ba77e8cd7562c48f52d9790c85e}{set\_initial\_state}}(\mbox{\hyperlink{classstate_1_1RobotState}{RobotState}}\& \mbox{\hyperlink{namespacestate}{state}}) \textcolor{keyword}{override};}
\DoxyCodeLine{148 }
\DoxyCodeLine{153   \textcolor{keywordtype}{void} \mbox{\hyperlink{classfilter_1_1inekf_1_1ImuPropagation_a3b046e708ac1b5299efa132a23d7773d}{clear}}() \textcolor{keyword}{override};}
\DoxyCodeLine{154 }
\DoxyCodeLine{156 }
\DoxyCodeLine{157  \textcolor{keyword}{private}:}
\DoxyCodeLine{160   \textcolor{comment}{// ======================================================================}}
\DoxyCodeLine{173 \textcolor{comment}{}  Eigen::MatrixXd StateTransitionMatrix(\textcolor{keyword}{const} Eigen::Vector3d\& w,}
\DoxyCodeLine{174                                         \textcolor{keyword}{const} Eigen::Vector3d\& a,}
\DoxyCodeLine{175                                         \textcolor{keyword}{const} \textcolor{keywordtype}{double} dt, \mbox{\hyperlink{classstate_1_1RobotState}{RobotState}}\& \mbox{\hyperlink{namespacestate}{state}});}
\DoxyCodeLine{176 }
\DoxyCodeLine{177   \textcolor{comment}{// ======================================================================}}
\DoxyCodeLine{189 \textcolor{comment}{}  Eigen::MatrixXd DiscreteNoiseMatrix(\textcolor{keyword}{const} Eigen::MatrixXd\& Phi,}
\DoxyCodeLine{190                                       \textcolor{keyword}{const} \textcolor{keywordtype}{double} dt, \textcolor{keyword}{const} \mbox{\hyperlink{classstate_1_1RobotState}{RobotState}}\& \mbox{\hyperlink{namespacestate}{state}});}
\DoxyCodeLine{192 }
\DoxyCodeLine{193 }
\DoxyCodeLine{194   \textcolor{keyword}{const} \mbox{\hyperlink{namespacefilter_1_1inekf_a7ef14ea922d7f9fc9e348cb4a18e1823}{ErrorType}} error\_type\_;            }
\DoxyCodeLine{196   \mbox{\hyperlink{type__def_8h_ac57b15fb1e344a7041a287e5d13e1b00}{IMUQueuePtr}} sensor\_data\_buffer\_ptr\_;    \textcolor{comment}{// Pointer to the sensor data buffer.}}
\DoxyCodeLine{197   \mbox{\hyperlink{type__def_8h_aa48eb7ad7e7ce4c6571f7c3fe0ec261f}{ImuMeasurementPtr}} prev\_imu\_measurement\_;    \textcolor{comment}{// Previous IMU measurement.}}
\DoxyCodeLine{198 }
\DoxyCodeLine{199   Eigen::Matrix3d R\_imu2body\_; }
\DoxyCodeLine{202   Eigen::Vector3d t\_imu2body\_; }
\DoxyCodeLine{205   \textcolor{comment}{// IMU bias initialization related variables:}}
\DoxyCodeLine{206   Eigen::Vector3d bg0\_ = Eigen::Vector3d::Zero();    \textcolor{comment}{// Gyroscope bias prior.}}
\DoxyCodeLine{207   Eigen::Vector3d ba0\_}
\DoxyCodeLine{208       = Eigen::Vector3d::Zero();      \textcolor{comment}{// Accelerometer bias prior.}}
\DoxyCodeLine{209   Eigen::Matrix3d gyro\_cov\_;          \textcolor{comment}{// Gyroscope measurement covariance.}}
\DoxyCodeLine{210   Eigen::Matrix3d accel\_cov\_;         \textcolor{comment}{// Accelerometer measurement covariance.}}
\DoxyCodeLine{211   Eigen::Matrix3d gyro\_bias\_cov\_;     \textcolor{comment}{// Gyroscope bias covariance.}}
\DoxyCodeLine{212   Eigen::Matrix3d accel\_bias\_cov\_;    \textcolor{comment}{// Accelerometer bias covariance.}}
\DoxyCodeLine{213 }
\DoxyCodeLine{214   \textcolor{keywordtype}{bool} enable\_imu\_bias\_update\_}
\DoxyCodeLine{215       = \textcolor{keyword}{false}; }
\DoxyCodeLine{218   \textcolor{keywordtype}{bool} static\_bias\_initialization\_;    \textcolor{comment}{// Flag for static bias initialization}}
\DoxyCodeLine{219   \textcolor{keywordtype}{bool} use\_imu\_ori\_to\_init\_;           }
\DoxyCodeLine{226   \textcolor{keywordtype}{bool} bias\_initialized\_ = \textcolor{keyword}{false};      }
\DoxyCodeLine{228   \textcolor{keywordtype}{int} init\_bias\_size\_; }
\DoxyCodeLine{230   std::vector<Eigen::Matrix<double, 6, 1>,}
\DoxyCodeLine{231               Eigen::aligned\_allocator<Eigen::Matrix<double, 6, 1>>>}
\DoxyCodeLine{232       bias\_init\_vec\_; }
\DoxyCodeLine{235 \};                    \textcolor{comment}{// End of class ImuPropagation}}
\DoxyCodeLine{236 \}    \textcolor{comment}{// namespace filter::inekf}}
\DoxyCodeLine{237 }
\DoxyCodeLine{238 \textcolor{preprocessor}{\#endif    }\textcolor{comment}{// FILTER\_INEKF\_PROPAGATION\_IMU\_PROPAGATION\_H}}

\end{DoxyCode}
